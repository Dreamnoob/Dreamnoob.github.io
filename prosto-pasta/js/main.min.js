toggleHeaderMenu();

toggleBasket();

mobileHeight();

initAccordion();

initTextarea();

helpAdaptive();

toggleCookiesPopup();

toggleReviewsSubslider();

initTouchRating();

showHiddenField(".checkout-textarea", ".checkout-comment");

showHiddenField(".checkout-promocode", ".checkout-add");

initTabs(".checkout-delivery-tab", ".checkout-delivery-fields")

window.addEventListener('resize', () => {
    mobileHeight();
    helpAdaptive();
});


function toggleHeaderMenu() {
    const headerBurger = document.querySelector(".header-burger");
    const headerNav = document.querySelector(".header-nav");

    headerBurger.addEventListener('click', function () {
        this.classList.toggle('active');
        headerNav.classList.toggle('active');
    });
}


function toggleBasket() {
    const headerBasketBtn = document.querySelector(".header-basket");
    const basketCloseBtn = document.querySelector(".basket-close");
    const basket = document.querySelector(".basket");

    headerBasketBtn.addEventListener('click', function () {
        basket.classList.add('active');
    });

    basketCloseBtn.addEventListener('click', function () {
        basket.classList.remove('active');
    });
}

function mobileHeight() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}


function initAccordion() {
    const questions = document.querySelectorAll(".help-question");

    if (questions.length !== 0) {
        questions.forEach(function (item) {
            item.addEventListener("click", function () {
                if (this.classList.contains("active")) {
                    this.classList.remove("active");
                    this.nextElementSibling.style.maxHeight = "";
                    this.nextElementSibling.classList.remove("active");
                } else {
                    this.classList.add("active");
                    this.nextElementSibling.style.maxHeight = this.nextElementSibling.scrollHeight + "px";
                    this.nextElementSibling.classList.add("active");
                }
            });
        });
    }
}

function initTextarea() {
    const textarea = document.querySelector(".field-textarea");

    if (textarea) {
        textarea.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    }
}

function helpAdaptive() {
    const form = document.querySelector(".help-form");
    const blockOne = document.querySelector(".help-one");
    const blockTwo = document.querySelector(".help-two");

    if (form && blockOne && blockTwo) {
        if (window.innerWidth >= 1024 && !form.classList.contains("adaptive")) {
            blockTwo.appendChild(form);
            form.classList.add("adaptive");
        } else if (window.innerWidth < 1024 && form.classList.contains("adaptive")) {
            blockOne.appendChild(form);
            form.classList.remove("adaptive");
        }
    }
}

function toggleCookiesPopup() {
    function setCookie(name, value) {
        document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
    }

    function getCookie(name) {
        let matches = document.cookie.match(new RegExp(
            "(?:^|; )" + name.replace(/([.$?*|{}()\[\]\\\/+^])/g, '\\$1') + "=([^;]*)"
        ));
        return matches ? decodeURIComponent(matches[1]) : undefined;
    }

    if (!getCookie('policyAgree')) {
        const popup = document.querySelector(".cookies-popup");
        const btn = document.querySelector(".cookies-popup-btn");

        setTimeout(() => {
            popup.classList.add('active');
        }, 3000);

        btn.addEventListener("click", () => {
            popup.classList.remove('active');
            setCookie('policyAgree', 'true');
        });
    }
}


function toggleReviewsSubslider() {
    const reviewSlides = document.querySelectorAll(".reviews-slide");
    const reviewSubslider = document.querySelector('.reviews-subslider');
    const reviewSubsliderClose = document.querySelector('.reviews-subslider-close');

    if (reviewSlides.length != 0) {
        reviewSlides.forEach(item => {
            item.addEventListener("click", () => {
                reviewSubslider.classList.add('open');
            });
        })
        reviewSubsliderClose.addEventListener("click", () => {
            reviewSubslider.classList.remove('open');
        });
    }
}


function initTouchRating() {
    const ratingItemsList = document.querySelectorAll('.reviews-rating-item');

    if (ratingItemsList.length != 0) {
        ratingItemsList.forEach(item => {
            item.addEventListener('click', () => {
                item.parentNode.dataset.totalValue = item.dataset.ratingValue;
            });
        });
    }
}

function showHiddenField(field, button) {
    const textarea = document.querySelector(field);
    const btn = document.querySelector(button);

    if (btn) {
        btn.addEventListener("click", function () {
            console.log("click");
            this.classList.add("hide");
            textarea.classList.add("show");
        })
    }
}

function initTabs(tabs, contentItems) {
    let tabsList = document.querySelectorAll(tabs);
    let contentList = document.querySelectorAll(contentItems);

    if (tabsList.length != 0) {
        tabsList.forEach(function (item) {
            item.addEventListener('click', function () {
                if (!item.classList.contains('active')) {
                    tabsList.forEach(function (item) {
                        item.classList.remove('active');
                    });

                    contentList.forEach(function (item) {
                        item.classList.remove('active');
                    });

                    this.classList.add("active");
                    let tabId = this.getAttribute("data-id");
                    let currentItem = document.getElementById(tabId);
                    currentItem.classList.add('active');
                }
            });
        });
    }
}



function toggleDeliveryMethods() {
    const inputs = document.querySelectorAll(".checkout-delivery-radio input");
    const deliveryList = document.querySelectorAll(".checkout-delivery-item");

    inputs.forEach((input, i) => {
        input.addEventListener("change", function() {
            let currentInputNumber = i;

            deliveryList.forEach((item, i) => {
                if(i == currentInputNumber) {
                    item.classList.add("active");
                } else {
                    item.classList.remove("active");
                }
            })
        })
    })
}

toggleDeliveryMethods();